<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>任务发布</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/base.css" />
		<link href="../css/mui.imageViewers.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="../icont/iconfont.css" />
		<link rel="stylesheet" href="../css/flow.css">

	</head>

	<body>
		<section id="app" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<div class="mui-pull-left lishi"><i class="iconFont"></i>教程</div>
				<h1 class="mui-title">任务发布</h1>
			</header>
			<div class="mui-content">

				<!-- tabs切换 -->
				<div class="tabsBox">
					<div :class="{ bgOrange: taskType==1}" @tap="changeTaskType(1)">流量任务</div>
					<div :class="{ bgYellow: taskType==2}" @tap="changeTaskType(2)">收藏任务</div>
					<div :class="{ bgAzure: taskType==3}" @tap="changeTaskType(3)">加购任务</div>
					<div :class="{ bgBlue: taskType==4}" @tap="changeTaskType(4)">淘宝直播</div>
				</div>
				<div class="mainTop">
					<!-- 流量任务类型 -->
					<div class="flowBox">
						<div class="title">
							<i class="icon iconType"></i>
							<div>任务类型</div>
						</div>
						<!-- 流量任务 -->
						<div class="typesBox" v-if="taskType==1">
							<div class="active">APP 流量</div>
							<div>PC 流量</div>
							<div>直访流量</div>
						</div>
						<!-- 收藏任务 -->
						<div class="typesBox" v-else-if="taskType==2">
							<div class="active">搜索收藏</div>
							<div>商品收藏</div>
							<div>店铺收藏</div>
							<div>商品点赞</div>
						</div>
						<!-- 加购任务 -->
						<div class="typesBox" v-else-if="taskType==3">
							<div class="active">搜索加购</div>
							<div>直接加购</div>
						</div>
						<!-- 淘宝直播 -->
						<div class="typesBox" v-else>
							<div class="active">达人关注</div>
							<div>微淘点赞</div>
							<div>观看人数</div>
						</div>
					</div>


					<!-- 任务日期 -->
					<div class="flowBox">
						<div class="title">
							<i class="icon iconDate"></i>
							<div>任务日期</div>
						</div>
						<div class="timeBox">
							<div class="dateBox" @tap="setOrderTime(23,1)">
								<span>{{taskDateStart}}</span>
								<i class="icon"></i>
							</div>
							<div class="until">—</div>
							<div class="dateBox" @tap="setOrderTime(23,2)">
								<span>{{taskDateEnd}}</span>
								<i class="icon"></i>
							</div>
						</div>
						<ul>
							<li>快速选择：</li>
							<li v-for="(item,index) in dateList" :class="{active:fastDay==item}" @tap="changeFastDay(item)">{{item}}天</li>
							
						</ul>
						<div class="totalTime">任务时长 <span>1</span> 天，每天发布 <span>100</span> 个任务量，此次合计发布<span>100</span>个任务</div>
					</div>
				</div>

				<div class="calendarBox">
					<div class="title">
						<i class="icon iconType"></i>
						<div>任务信息</div>
					</div>
					<div class="calendarItem" v-for="(item,index) in periodList">
						<ul >
							<!-- 流量任务 收藏任务  加购任务 -->
							<li v-if="taskType!==4">
								<label for="">商品链接</label>
								<div class="inputBox">
									<input class="inputItem" type="text" placeholder="请输入链接或淘口令" />
								</div>
							</li>
							<li v-if="taskType!==4">
								<label for="">关键词</label>
								<div class="inputBox">
									<input class="inputItem" type="text" placeholder="请输入关键词" />
								</div>
								<button class="" type="button">查排名</button>
							</li>
							<!-- 淘宝直播 -->
							<li v-if="taskType==4">
								<label for="">店铺链接</label>
								<div class="inputBox">
									<input class="inputItem" type="text" placeholder="请输入链接或淘口令" />
								</div>
							</li>
							
							<li>
								<label v-if="taskType==1">访客数量</label>
								<label v-else-if="taskType==2">收藏数量</label>
								<label v-else-if="taskType==3">加购数量</label>
								<label v-else>粉丝数量</label>
								<div class="inputBox">
									<div class="num-count">
										<div class="count-desc" type="button">-</div>
										<input class="count-input" type="number" :value="item.infoNum" pattern="[0-9]*" />
										<div class="count-add" type="button">+</div>
									</div>
								</div>
								<button class="" type="button">时段</button>
							</li>
						</ul>

						
						<!-- <ul v-else>
							<li>
								<label >粉丝数量</label>
								<div class="inputBox">
									<div class="num-count">
										<button class="count-desc" type="button">-</button>
										<input class="count-input" type="number" pattern="[0-9]*" />
										<button class="count-add" type="button">+</button>
									</div>

								</div>
								<button class="" type="button">时段</button>
							</li>
						</ul> -->

						<!-- 24h -->
						<div class="periodBox">
							<ul>
								<li v-for="(ite,index) in item.numItem">
									<div class="hours">{{index>=10?index:"0"+index}}:00</div>
									<div class="percentage">2.0%{{ite}}</div>
									<div class="hoursInput">
										<input type="text" v-if="!ite.isShow"  value="0">
										<!-- <input type="text" v-else :value="item.numItem[index].size"> -->
									</div>
								</li>
							</ul>
						</div>

						<div class="totalTime">共 <span>{{item.infoNum}}</span> 个任务，已分配 <span>{{item.infoNum}}</span> 个，剩余未分配<span class="renText">0</span>个任务</div>
						<div class="fillBox">
							<i></i>
							<div class="active">随机填充</div>
							<div>历史发布</div>
						</div>
						<div class="delBox">
							<div>删除</div>
						</div>
					</div>
					<div class="addBox">添加</div>
				</div>

				<div class="ulBox">
					<ul>
						<li>
							<label>浏览时间</label>
							<div>
								<span>100-180秒(免费)</span>
								<i></i>
							</div>
						</li>
						<li>
							<label>浏览深度</label>
							<div>
								<span>不浏览</span>
								<i></i>
							</div>
						</li>
						<li>
							<label>任务备注</label>
							<div class="inputBox">
								<input type="text" placeholder="请输入备注（可不填）">
							</div>
						</li>
					</ul>
				</div>

				<div class="priceInfo">
					<div class="title">
						<i class="icon iconPrice"></i>
						<div>计费方式</div>
					</div>
					<div>任务耗时: <span>100-180</span> 秒,单次消费<span>¥30</span></div>
					<div>合计消费: <span>￥3000</span></div>
					<div class="referBox">
						<div>应付金额：<span>￥378</span></div>
						<div class="referBtn">提交订单</div>
					</div>
				</div>
			</div>
		</section>

		<script src="../js/jquery-3.2.1.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/mui.zoom.js"></script>
		<script src="../js/mui.previewimage.js"></script>
		<script src="../js/castapp.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/browser.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/axios.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/qs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/api.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/storage.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/babel">

			var app = new Vue({
				el:'#app',
				data(){
					return {
						taskType:1,
						startHour:24,//当前小时
						taskDateStart:this.changeTomorrow(0),//任务开始日期
						taskDateEnd:this.changeTomorrow(1),//任务结束日期
						dateList:[1,3,7,10,15,30],//快速选择时间列表
						fastDay:1,//快速选择时间
						periodList:[this.periodItem()],
						numList:[],
						// periodItem:{
						// 	links:"",//链接
						// 	keyword:"",//关键词
						// 	infoNum:"",//数量
						// 	numItem:[],
						// },//任务信息数据
					}
				},
				computed:{
					// 计算应付金额
					
				},
				methods:{
					periodItem(){
						return {
							links:"",//链接
							keyword:"",//关键词
							infoNum:100,//数量
							numItem:[
								{time:0,size:0,isShow:false},
								{time:1,size:0,isShow:false},
								{time:2,size:0,isShow:false},
								{time:3,size:0,isShow:false},
								{time:4,size:0,isShow:false},
								{time:5,size:0,isShow:false},
								{time:6,size:0,isShow:false},
								{time:7,size:0,isShow:false},
								{time:8,size:0,isShow:false},
								{time:9,size:0,isShow:false},
								{time:10,size:0,isShow:false},
								{time:11,size:0,isShow:false},
								{time:12,size:0,isShow:false},
								{time:13,size:0,isShow:false},
								{time:14,size:0,isShow:false},
								{time:15,size:0,isShow:false},
								{time:16,size:0,isShow:false},
								{time:17,size:0,isShow:false},
								{time:18,size:0,isShow:false},
								{time:19,size:0,isShow:false},
								{time:20,size:0,isShow:false},
								{time:21,size:0,isShow:false},
								{time:22,size:0,isShow:false},
								{time:23,size:0,isShow:false}
							]
						};
					},
					
					changeTaskType(type){
						this.taskType=type;
					},
					// 设置时间
					setOrderTime(item,type){
						var time = new Date();
						var startHour = time.getHours();
						var startMinutes = time.getMinutes();
						
						this.timePicker = new mui.DtPicker({
							type: "time", //设置日历初始视图模式
							customData: {
								h: getTime(startHour,24),
								i: getTime(startMinutes,59)
							}//时间/日期别名
						});
						this.timePicker.show((selectItems) => {
							// if(type){
							// 	if(item.shuadan_end_time && selectItems > item.shuadan_end_time){
							// 		ca.prompt('开始时间不能大于结束时间！');
							// 		return;
							// 	}
							// 	item.shuadan_start_time = selectItems.text;
							// }else{
							// 	if(item.shuadan_start_time && selectItems < item.shuadan_start_time){
							// 		ca.prompt('结束时间不能小于开始时间！');
							// 		return;
							// 	}
							// 	item.shuadan_end_time = selectItems.text;
							// }
							this.timePicker.dispose();
						});
					},
					changeFastDay(type){
						this.fastDay=type;
						this.taskDateEnd=this.changeTomorrow(type);
					},
					// 随机分配任务数量
					getRandomMoney(remainMoney, remainSize) {
						let that=this;
						let moneyList = [];
						const min = 1;
						let max, money;
						while (remainSize > 1) {
							max = remainMoney / remainSize * 2;
							money = parseInt(Math.random() * max);
							money = money < 1 ? 1 : money;
							money = Math.round(money * 100) / 100;
							// moneyList.push(money);
							moneyList.push({time:that.startHour++,size:money});
							
							remainSize--;
							remainMoney -= money;
						}
				
						moneyList.push({time:that.startHour++,size:Math.round(remainMoney * 100) / 100});
						return moneyList;
					},
					
					
					// 修改天数
					changeTomorrow(days){
						var time = new Date().getTime() + 24 * 60 * 60 * 1000 * days;
						var yesterday = new Date(time);
						var month = yesterday.getMonth();
						var day = yesterday.getDate();
						yesterday =
							yesterday.getFullYear() +
							'-' +
							(yesterday.getMonth() > 9 ? yesterday.getMonth() + 1 : '0' + (yesterday.getMonth() + 1)) +
							'-' +
							(yesterday.getDate() > 9 ? yesterday.getDate() : '0' + yesterday.getDate());
						
						return yesterday;
					}
					
					
				},
				created(){
					
					
				},
				mounted(){
					mui.init();
					
					mui.plusReady(function(){
						
					});
					var that=this;
					var time = new Date();
					that.startHour =parseInt(time.getHours()) ;
					var arr=that.getRandomMoney(100,24 - that.startHour);
					arr.map((item)=>{
						
						that.periodList[0].numItem.map((ite,index)=>{
							if(ite.time==item.time){
								that.periodList[0].numItem.isShow=true;
								that.periodList[0].numItem.size=item.size;
								console.log(that.periodList[0].numItem.isShow);
							}
						});
						
					})
					
				},
				watch:{

				}
			});
			
		</script>
	</body>

</html>
